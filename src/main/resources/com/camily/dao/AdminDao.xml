<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.camily.dao.AdminDao">

	<select id="getMemberList" resultType="com.camily.dto.MemberDto">
		SELECT MID, MPW, MNAME, MTEL, MEMAIL, TO_CHAR(MBIRTH,'YYYY-MM-DD') AS MBIRTH,
			   MADDR, MSTATE
		FROM (SELECT ROWNUM RN, MEMBERS.* FROM MEMBERS ORDER BY MNAME) 
		WHERE RN BETWEEN #{startRow} AND #{endRow}
	</select>
	<!-- <select id="getMemberList" resultType="com.camily.dto.MemberDto">
		SELECT * 
		FROM ( 	SELECT ROWNUM RN, MEMBERS.*
		       		FROM ( 	SELECT MEMBERS.*, CA.CRPRICE FROM CAMPING
		             			LEFT OUTER JOIN ( SELECT C.CACODE, MIN(TO_NUMBER(CR.CRPRICE)) AS CRPRICE
		                    	FROM CAMPING C
		              			LEFT OUTER JOIN CAMPINGROOM CR ON C.CACODE = CR.CRCACODE
		                       	GROUP BY C.CACODE ) CA ON CAMPING.CACODE = CA.CACODE
		            <if test="type.length > 0">
		       		WHERE CATYPE LIKE '%'||#{type}||'%'
		       		</if>
		      		ORDER BY CAMPING.CACODE) CAMPING)
		WHERE RN BETWEEN #{startRow} AND #{endRow}
	</select> -->
	
	<select id="getMemberTotalCount" resultType="int">
		SELECT COUNT(*) FROM MEMBERS
	</select>	
		
	<update id="updateMemberState">
		UPDATE MEMBERS
		SET MSTATE = #{mstate}
		WHERE MID = #{mid}
	</update>
	
	<select id="selectMemberInfo" resultType="com.camily.dto.MemberDto">
		SELECT MID, MPW, MNAME, MTEL, MEMAIL, TO_CHAR(MBIRTH,'YYYY-MM-DD') AS MBIRTH,
			   MADDR, MSTATE
		FROM MEMBERS
		WHERE MID = #{mid}
	</select>

    <select id="getCampingList" resultType="com.camily.dto.CampingDto" >
        SELECT * 
		FROM ( 	SELECT ROWNUM RN, CAMPING.*
		       		FROM ( 	SELECT CAMPING.*, CA.CRPRICE FROM CAMPING
		             		LEFT OUTER JOIN ( SELECT C.CACODE, MIN(TO_NUMBER(CR.CRPRICE)) AS CRPRICE
		                    FROM CAMPING C
		              		LEFT OUTER JOIN CAMPINGROOM CR ON C.CACODE = CR.CRCACODE
		                    GROUP BY C.CACODE ) CA ON CAMPING.CACODE = CA.CACODE
		      		ORDER BY CAMPING.CACODE) CAMPING)
		WHERE RN BETWEEN #{startRow} AND #{endRow}
    </select>

	<select id="getCampTotalCount" resultType="int">
		SELECT COUNT(*) FROM CAMPING
	</select>
    
    <update id="updateCampingState">
         UPDATE CAMPING
         SET CASTATE = #{castate}
         WHERE CACODE = #{cacode}
    </update>
    
    <select id="selectCampingInfo" resultType="com.camily.dto.CampingDto">
        SELECT * FROM CAMPING WHERE CACODE = #{cacode}
    </select>
    
    <update id="updateCampingInfo">
        UPDATE CAMPING
        <set>
        CANAME = #{caname},
        CALINECONTENTS = #{calinecontents},
        CACONTENTS = #{cacontents},
        CAINFO = #{cainfo},
        CATYPE = #{catype},
        <if test="caimage.length > 0">
        CAIMAGE = #{caimage}
        </if>
        </set>
        WHERE CACODE = #{cacode}
    </update>
    
    <select id="getMaxCacode" resultType="string">
      SELECT MAX(CACODE)
      FROM CAMPING
    </select>
    
    <insert id="insertCamping">
    INSERT INTO CAMPING (CACODE,CANAME,CALATITUDE,CALONGITUDE,CACONTENTS,CAINFO,CAIMAGE,CATYPE,CALINECONTENTS,CASTATE) VALUES 
    (#{cacode},#{caname},#{calatitude},#{calongitude},#{cacontents},#{cainfo},#{caimage},#{catype},#{calinecontents}, 1)
    
    </insert>
    
    <update id="bannerModify">
    UPDATE BANNER
	<set>
		BNIMAGE = #{bnimage},
		BNTITLE = #{bntitle},
		BNTITLEEFFECT = #{bntitleeffect},
		BNCONTENTS = #{bncontents},
		BNCONTENTSEFFECT = #{bncontentseffect},
		BNLINK = #{bnlink},
		BNLINKEFFECT = #{bnlinkeffect}
	</set>
	WHERE BNCODE = #{bncode}
    </update>
    
</mapper>